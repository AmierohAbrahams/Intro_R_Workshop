<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Intro R Workshop: Data Manipulation, Analysis and Graphing</title>
  <meta name="description" content="The basics for a safe voyage through the tidyverse.">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Intro R Workshop: Data Manipulation, Analysis and Graphing" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The basics for a safe voyage through the tidyverse." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Intro R Workshop: Data Manipulation, Analysis and Graphing" />
  
  <meta name="twitter:description" content="The basics for a safe voyage through the tidyverse." />
  

<meta name="author" content="Robert W Schlegel &amp; AJ Smit">


<meta name="date" content="2018-01-08">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="plot-stats.html">
<link rel="next" href="mapping-google.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Intro R Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="prelim.html"><a href="prelim.html"><i class="fa fa-check"></i><b>1</b> Preliminaries</a><ul>
<li class="chapter" data-level="1.1" data-path="prelim.html"><a href="prelim.html#venue-date-and-time"><i class="fa fa-check"></i><b>1.1</b> Venue, date and time</a></li>
<li class="chapter" data-level="1.2" data-path="prelim.html"><a href="prelim.html#course-outline"><i class="fa fa-check"></i><b>1.2</b> Course outline</a><ul>
<li class="chapter" data-level="" data-path="prelim.html"><a href="prelim.html#day-1-in-the-beginning"><i class="fa fa-check"></i>Day 1 – In the Beginning</a></li>
<li class="chapter" data-level="" data-path="prelim.html"><a href="prelim.html#day-2-show-and-tell"><i class="fa fa-check"></i>Day 2 – Show and tell</a></li>
<li class="chapter" data-level="" data-path="prelim.html"><a href="prelim.html#day-3-going-deeper"><i class="fa fa-check"></i>Day 3 – Going deeper</a></li>
<li class="chapter" data-level="" data-path="prelim.html"><a href="prelim.html#day-4-the-enlightened-researcher"><i class="fa fa-check"></i>Day 4 – The Enlightened Researcher</a></li>
<li class="chapter" data-level="" data-path="prelim.html"><a href="prelim.html#day-5-the-world-is-yours"><i class="fa fa-check"></i>Day 5 – The world is yours</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="prelim.html"><a href="prelim.html#about-this-workshop"><i class="fa fa-check"></i><b>1.3</b> About this Workshop</a></li>
<li class="chapter" data-level="1.4" data-path="prelim.html"><a href="prelim.html#why-can-haz-r"><i class="fa fa-check"></i><b>1.4</b> Why can haz R?</a><ul>
<li class="chapter" data-level="1.4.1" data-path="prelim.html"><a href="prelim.html#some-negatives-of-using-r"><i class="fa fa-check"></i><b>1.4.1</b> Some negatives of using R</a></li>
<li class="chapter" data-level="1.4.2" data-path="prelim.html"><a href="prelim.html#the-challenge-learning-to-program-in-r"><i class="fa fa-check"></i><b>1.4.2</b> The challenge: learning to program in R</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="prelim.html"><a href="prelim.html#using-your-own-computer"><i class="fa fa-check"></i><b>1.5</b> Using your own computer?</a><ul>
<li class="chapter" data-level="1.5.1" data-path="prelim.html"><a href="prelim.html#installing-r"><i class="fa fa-check"></i><b>1.5.1</b> Installing R</a></li>
<li class="chapter" data-level="1.5.2" data-path="prelim.html"><a href="prelim.html#installing-rstudio"><i class="fa fa-check"></i><b>1.5.2</b> Installing RStudio</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="prelim.html"><a href="prelim.html#resources"><i class="fa fa-check"></i><b>1.6</b> Resources</a></li>
<li class="chapter" data-level="1.7" data-path="prelim.html"><a href="prelim.html#style-and-code-conventions"><i class="fa fa-check"></i><b>1.7</b> Style and code conventions</a></li>
<li class="chapter" data-level="1.8" data-path="prelim.html"><a href="prelim.html#about-this-document"><i class="fa fa-check"></i><b>1.8</b> About this document</a></li>
<li class="chapter" data-level="1.9" data-path="prelim.html"><a href="prelim.html#exercise-it-which-shall-not-be-named"><i class="fa fa-check"></i><b>1.9</b> Exercise: It which shall not be named</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rstudio.html"><a href="rstudio.html"><i class="fa fa-check"></i><b>2</b> RStudio</a><ul>
<li class="chapter" data-level="2.1" data-path="rstudio.html"><a href="rstudio.html#setting-up-the-workspace"><i class="fa fa-check"></i><b>2.1</b> Setting up the workspace</a><ul>
<li class="chapter" data-level="2.1.1" data-path="rstudio.html"><a href="rstudio.html#general-settings"><i class="fa fa-check"></i><b>2.1.1</b> General settings</a></li>
<li class="chapter" data-level="2.1.2" data-path="rstudio.html"><a href="rstudio.html#customising-appearance"><i class="fa fa-check"></i><b>2.1.2</b> Customising appearance</a></li>
<li class="chapter" data-level="2.1.3" data-path="rstudio.html"><a href="rstudio.html#configuring-panes"><i class="fa fa-check"></i><b>2.1.3</b> Configuring panes</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="rstudio.html"><a href="rstudio.html#rprojects"><i class="fa fa-check"></i><b>2.2</b> RProject’s</a></li>
<li class="chapter" data-level="2.3" data-path="rstudio.html"><a href="rstudio.html#installing-packages"><i class="fa fa-check"></i><b>2.3</b> Installing packages</a></li>
<li class="chapter" data-level="2.4" data-path="rstudio.html"><a href="rstudio.html#the-panes-of-rstudio"><i class="fa fa-check"></i><b>2.4</b> The panes of RStudio</a><ul>
<li class="chapter" data-level="2.4.1" data-path="rstudio.html"><a href="rstudio.html#source-editor"><i class="fa fa-check"></i><b>2.4.1</b> Source Editor</a></li>
<li class="chapter" data-level="2.4.2" data-path="rstudio.html"><a href="rstudio.html#console"><i class="fa fa-check"></i><b>2.4.2</b> Console</a></li>
<li class="chapter" data-level="2.4.3" data-path="rstudio.html"><a href="rstudio.html#environment-and-history-panes"><i class="fa fa-check"></i><b>2.4.3</b> Environment and History panes</a></li>
<li class="chapter" data-level="2.4.4" data-path="rstudio.html"><a href="rstudio.html#files-plots-packages-help-and-viewer-panes"><i class="fa fa-check"></i><b>2.4.4</b> Files, Plots, Packages, Help and Viewer panes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>3</b> An R workflow</a><ul>
<li class="chapter" data-level="3.1" data-path="workflow.html"><a href="workflow.html#r-scripts"><i class="fa fa-check"></i><b>3.1</b> R Scripts</a></li>
<li class="chapter" data-level="3.2" data-path="workflow.html"><a href="workflow.html#reading-data-into-r"><i class="fa fa-check"></i><b>3.2</b> Reading data into R</a><ul>
<li class="chapter" data-level="3.2.1" data-path="workflow.html"><a href="workflow.html#preparing-data-for-r"><i class="fa fa-check"></i><b>3.2.1</b> Preparing data for R</a></li>
<li class="chapter" data-level="3.2.2" data-path="workflow.html"><a href="workflow.html#converting-data"><i class="fa fa-check"></i><b>3.2.2</b> Converting data</a></li>
<li class="chapter" data-level="3.2.3" data-path="workflow.html"><a href="workflow.html#importing-data"><i class="fa fa-check"></i><b>3.2.3</b> Importing data</a></li>
<li class="chapter" data-level="3.2.4" data-path="workflow.html"><a href="workflow.html#loading-a-file"><i class="fa fa-check"></i><b>3.2.4</b> Loading a file</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="workflow.html"><a href="workflow.html#working-with-data"><i class="fa fa-check"></i><b>3.3</b> Working with data</a><ul>
<li class="chapter" data-level="3.3.1" data-path="workflow.html"><a href="workflow.html#examine-your-data"><i class="fa fa-check"></i><b>3.3.1</b> Examine your data</a></li>
<li class="chapter" data-level="3.3.2" data-path="workflow.html"><a href="workflow.html#tidyverse-sneak-peek"><i class="fa fa-check"></i><b>3.3.2</b> Tidyverse sneak peek</a></li>
<li class="chapter" data-level="3.3.3" data-path="workflow.html"><a href="workflow.html#subsetting"><i class="fa fa-check"></i><b>3.3.3</b> Subsetting</a></li>
<li class="chapter" data-level="3.3.4" data-path="workflow.html"><a href="workflow.html#basic-stats"><i class="fa fa-check"></i><b>3.3.4</b> Basic stats</a></li>
<li class="chapter" data-level="3.3.5" data-path="workflow.html"><a href="workflow.html#summary-of-all-variables-in-a-dataframe"><i class="fa fa-check"></i><b>3.3.5</b> Summary of all variables in a dataframe</a></li>
<li class="chapter" data-level="3.3.6" data-path="workflow.html"><a href="workflow.html#summary-statistics-by-variable"><i class="fa fa-check"></i><b>3.3.6</b> Summary statistics by variable</a></li>
<li class="chapter" data-level="3.3.7" data-path="workflow.html"><a href="workflow.html#more-complex-calculations"><i class="fa fa-check"></i><b>3.3.7</b> More complex calculations</a></li>
<li class="chapter" data-level="3.3.8" data-path="workflow.html"><a href="workflow.html#factor-summaries"><i class="fa fa-check"></i><b>3.3.8</b> Factor summaries</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="workflow.html"><a href="workflow.html#saving-data"><i class="fa fa-check"></i><b>3.4</b> Saving data</a></li>
<li class="chapter" data-level="3.5" data-path="workflow.html"><a href="workflow.html#visualisations"><i class="fa fa-check"></i><b>3.5</b> Visualisations</a></li>
<li class="chapter" data-level="3.6" data-path="workflow.html"><a href="workflow.html#clearing-the-memory"><i class="fa fa-check"></i><b>3.6</b> Clearing the memory</a></li>
<li class="chapter" data-level="3.7" data-path="workflow.html"><a href="workflow.html#working-directories"><i class="fa fa-check"></i><b>3.7</b> Working directories</a></li>
<li class="chapter" data-level="3.8" data-path="workflow.html"><a href="workflow.html#help"><i class="fa fa-check"></i><b>3.8</b> Help</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>4</b> Graphics with <strong><code>ggplot2</code></strong></a><ul>
<li class="chapter" data-level="4.1" data-path="graphics.html"><a href="graphics.html#example-figures"><i class="fa fa-check"></i><b>4.1</b> Example figures</a></li>
<li class="chapter" data-level="4.2" data-path="graphics.html"><a href="graphics.html#basics-of-ggplot2"><i class="fa fa-check"></i><b>4.2</b> Basics of <strong><code>ggplot2</code></strong></a></li>
<li class="chapter" data-level="4.3" data-path="graphics.html"><a href="graphics.html#changing-labels"><i class="fa fa-check"></i><b>4.3</b> Changing labels</a></li>
<li class="chapter" data-level="4.4" data-path="graphics.html"><a href="graphics.html#to-aes-or-not-to-aes-that-is-the-question"><i class="fa fa-check"></i><b>4.4</b> To <code>aes()</code> or not to <code>aes()</code>, that is the question</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="faceting.html"><a href="faceting.html"><i class="fa fa-check"></i><b>5</b> Faceting Figures</a><ul>
<li class="chapter" data-level="5.1" data-path="faceting.html"><a href="faceting.html#faceting-one-figure"><i class="fa fa-check"></i><b>5.1</b> Faceting one figure</a></li>
<li class="chapter" data-level="5.2" data-path="faceting.html"><a href="faceting.html#new-figure-types"><i class="fa fa-check"></i><b>5.2</b> New figure types</a><ul>
<li class="chapter" data-level="5.2.1" data-path="faceting.html"><a href="faceting.html#linear-model"><i class="fa fa-check"></i><b>5.2.1</b> Linear model</a></li>
<li class="chapter" data-level="5.2.2" data-path="faceting.html"><a href="faceting.html#histogram"><i class="fa fa-check"></i><b>5.2.2</b> Histogram</a></li>
<li class="chapter" data-level="5.2.3" data-path="faceting.html"><a href="faceting.html#density-plot"><i class="fa fa-check"></i><b>5.2.3</b> Density plot</a></li>
<li class="chapter" data-level="5.2.4" data-path="faceting.html"><a href="faceting.html#boxplot"><i class="fa fa-check"></i><b>5.2.4</b> Boxplot</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="faceting.html"><a href="faceting.html#gridding-figures"><i class="fa fa-check"></i><b>5.3</b> Gridding figures</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="brewing.html"><a href="brewing.html"><i class="fa fa-check"></i><b>6</b> Brewing colours in <strong><code>ggplot2</code></strong></a><ul>
<li class="chapter" data-level="6.1" data-path="brewing.html"><a href="brewing.html#r-data"><i class="fa fa-check"></i><b>6.1</b> R Data</a></li>
<li class="chapter" data-level="6.2" data-path="brewing.html"><a href="brewing.html#rcolorbrewer"><i class="fa fa-check"></i><b>6.2</b> <strong><code>RColorBrewer</code></strong></a></li>
<li class="chapter" data-level="6.3" data-path="brewing.html"><a href="brewing.html#make-your-own-palettes"><i class="fa fa-check"></i><b>6.3</b> Make your own palettes</a></li>
<li class="chapter" data-level="6.4" data-path="brewing.html"><a href="brewing.html#use-your-own-palettes"><i class="fa fa-check"></i><b>6.4</b> Use your own palettes</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="plot-stats.html"><a href="plot-stats.html"><i class="fa fa-check"></i><b>7</b> Plotting statistics</a><ul>
<li class="chapter" data-level="7.1" data-path="plot-stats.html"><a href="plot-stats.html#new-functions"><i class="fa fa-check"></i><b>7.1</b> New functions</a></li>
<li class="chapter" data-level="7.2" data-path="plot-stats.html"><a href="plot-stats.html#further-applications"><i class="fa fa-check"></i><b>7.2</b> Further applications</a></li>
<li class="chapter" data-level="7.3" data-path="plot-stats.html"><a href="plot-stats.html#diy-figures"><i class="fa fa-check"></i><b>7.3</b> DIY figures</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mapping.html"><a href="mapping.html"><i class="fa fa-check"></i><b>8</b> Mapping with <strong><code>ggplot2</code></strong></a><ul>
<li class="chapter" data-level="8.1" data-path="mapping.html"><a href="mapping.html#a-new-concept"><i class="fa fa-check"></i><b>8.1</b> A new concept?</a></li>
<li class="chapter" data-level="8.2" data-path="mapping.html"><a href="mapping.html#built-in-maps"><i class="fa fa-check"></i><b>8.2</b> Built in maps</a></li>
<li class="chapter" data-level="8.3" data-path="mapping.html"><a href="mapping.html#creating-a-map"><i class="fa fa-check"></i><b>8.3</b> Creating a map</a></li>
<li class="chapter" data-level="8.4" data-path="mapping.html"><a href="mapping.html#a-ribbon-for-your-troubles"><i class="fa fa-check"></i><b>8.4</b> A ribbon for your troubles</a></li>
<li class="chapter" data-level="8.5" data-path="mapping.html"><a href="mapping.html#combining-figures"><i class="fa fa-check"></i><b>8.5</b> Combining figures</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="mapping-google.html"><a href="mapping-google.html"><i class="fa fa-check"></i><b>9</b> Mapping with Google</a><ul>
<li class="chapter" data-level="9.1" data-path="mapping-google.html"><a href="mapping-google.html#ggmap"><i class="fa fa-check"></i><b>9.1</b> <strong><code>ggmap</code></strong></a></li>
<li class="chapter" data-level="9.2" data-path="mapping-google.html"><a href="mapping-google.html#mapping-cape-point"><i class="fa fa-check"></i><b>9.2</b> Mapping Cape Point</a></li>
<li class="chapter" data-level="9.3" data-path="mapping-google.html"><a href="mapping-google.html#site-labels"><i class="fa fa-check"></i><b>9.3</b> Site labels</a></li>
<li class="chapter" data-level="9.4" data-path="mapping-google.html"><a href="mapping-google.html#specific-labels"><i class="fa fa-check"></i><b>9.4</b> Specific labels</a></li>
<li class="chapter" data-level="9.5" data-path="mapping-google.html"><a href="mapping-google.html#scale-bars"><i class="fa fa-check"></i><b>9.5</b> Scale bars</a></li>
<li class="chapter" data-level="9.6" data-path="mapping-google.html"><a href="mapping-google.html#insetting"><i class="fa fa-check"></i><b>9.6</b> Insetting</a></li>
<li class="chapter" data-level="9.7" data-path="mapping-google.html"><a href="mapping-google.html#rounding-it-out"><i class="fa fa-check"></i><b>9.7</b> Rounding it out</a></li>
<li class="chapter" data-level="9.8" data-path="mapping-google.html"><a href="mapping-google.html#diy-maps"><i class="fa fa-check"></i><b>9.8</b> DIY maps</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>10</b> Tidy data</a><ul>
<li class="chapter" data-level="10.1" data-path="tidy.html"><a href="tidy.html#gathering-and-spreading"><i class="fa fa-check"></i><b>10.1</b> Gathering and spreading</a><ul>
<li class="chapter" data-level="10.1.1" data-path="tidy.html"><a href="tidy.html#gathering"><i class="fa fa-check"></i><b>10.1.1</b> Gathering</a></li>
<li class="chapter" data-level="10.1.2" data-path="tidy.html"><a href="tidy.html#spreading"><i class="fa fa-check"></i><b>10.1.2</b> Spreading</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tidy.html"><a href="tidy.html#separating-and-uniting"><i class="fa fa-check"></i><b>10.2</b> Separating and uniting</a><ul>
<li class="chapter" data-level="10.2.1" data-path="tidy.html"><a href="tidy.html#separate"><i class="fa fa-check"></i><b>10.2.1</b> Separate</a></li>
<li class="chapter" data-level="10.2.2" data-path="tidy.html"><a href="tidy.html#unite"><i class="fa fa-check"></i><b>10.2.2</b> Unite</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="tidy.html"><a href="tidy.html#joining"><i class="fa fa-check"></i><b>10.3</b> Joining</a></li>
<li class="chapter" data-level="10.4" data-path="tidy.html"><a href="tidy.html#but-why-though"><i class="fa fa-check"></i><b>10.4</b> But why though?</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="tidier.html"><a href="tidier.html"><i class="fa fa-check"></i><b>11</b> Tidier data</a><ul>
<li class="chapter" data-level="11.1" data-path="tidier.html"><a href="tidier.html#comparison-operators"><i class="fa fa-check"></i><b>11.1</b> Comparison operators</a></li>
<li class="chapter" data-level="11.2" data-path="tidier.html"><a href="tidier.html#logical-operators"><i class="fa fa-check"></i><b>11.2</b> Logical operators</a></li>
<li class="chapter" data-level="11.3" data-path="tidier.html"><a href="tidier.html#arrange-observations-rows-with-arrange"><i class="fa fa-check"></i><b>11.3</b> Arrange observations (rows) with <code>arrange()</code></a></li>
<li class="chapter" data-level="11.4" data-path="tidier.html"><a href="tidier.html#filter-observations-rows-with-filter"><i class="fa fa-check"></i><b>11.4</b> Filter observations (rows) with <code>filter()</code></a></li>
<li class="chapter" data-level="11.5" data-path="tidier.html"><a href="tidier.html#select-variables-columns-withselect"><i class="fa fa-check"></i><b>11.5</b> Select variables (columns) with<code>select()</code></a></li>
<li class="chapter" data-level="11.6" data-path="tidier.html"><a href="tidier.html#create-new-variables-columns-with-mutate"><i class="fa fa-check"></i><b>11.6</b> Create new variables (columns) with <code>mutate()</code></a></li>
<li class="chapter" data-level="11.7" data-path="tidier.html"><a href="tidier.html#summarise-variables-columns-with-summarise"><i class="fa fa-check"></i><b>11.7</b> Summarise variables (columns) with <code>summarise()</code></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="tidiest.html"><a href="tidiest.html"><i class="fa fa-check"></i><b>12</b> Tidiest data</a><ul>
<li class="chapter" data-level="12.1" data-path="tidiest.html"><a href="tidiest.html#group-observations-rows-by-variables-columns-with-group_by"><i class="fa fa-check"></i><b>12.1</b> Group observations (rows) by variables (columns) with <code>group_by()</code></a><ul>
<li class="chapter" data-level="12.1.1" data-path="tidiest.html"><a href="tidiest.html#grouping-by-multiple-variables"><i class="fa fa-check"></i><b>12.1.1</b> Grouping by multiple variables</a></li>
<li class="chapter" data-level="12.1.2" data-path="tidiest.html"><a href="tidiest.html#ungrouping"><i class="fa fa-check"></i><b>12.1.2</b> Ungrouping</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="tidiest.html"><a href="tidiest.html#chain-functions-with-the-pipe"><i class="fa fa-check"></i><b>12.2</b> Chain functions with the pipe (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="12.3" data-path="tidiest.html"><a href="tidiest.html#group-all-the-functions"><i class="fa fa-check"></i><b>12.3</b> Group all the functions!</a></li>
<li class="chapter" data-level="12.4" data-path="tidiest.html"><a href="tidiest.html#going-deeper"><i class="fa fa-check"></i><b>12.4</b> Going deeper</a></li>
<li class="chapter" data-level="12.5" data-path="tidiest.html"><a href="tidiest.html#pipe-into-ggplot2"><i class="fa fa-check"></i><b>12.5</b> Pipe into <strong><code>ggplot2</code></strong></a></li>
<li class="chapter" data-level="12.6" data-path="tidiest.html"><a href="tidiest.html#additional-useful-functions"><i class="fa fa-check"></i><b>12.6</b> Additional useful functions</a><ul>
<li class="chapter" data-level="12.6.1" data-path="tidiest.html"><a href="tidiest.html#rename-variables-columns-with-rename"><i class="fa fa-check"></i><b>12.6.1</b> Rename variables (columns) with <code>rename()</code></a></li>
<li class="chapter" data-level="12.6.2" data-path="tidiest.html"><a href="tidiest.html#create-a-new-dataframe-for-a-newly-created-variable-column-with-transmute"><i class="fa fa-check"></i><b>12.6.2</b> Create a new dataframe for a newly created variable (column) with <code>transmute()</code></a></li>
<li class="chapter" data-level="12.6.3" data-path="tidiest.html"><a href="tidiest.html#count-observations-rows-with-n"><i class="fa fa-check"></i><b>12.6.3</b> Count observations (rows) with <code>n()</code></a></li>
<li class="chapter" data-level="12.6.4" data-path="tidiest.html"><a href="tidiest.html#select-observations-rows-by-number-with-slice"><i class="fa fa-check"></i><b>12.6.4</b> Select observations (rows) by number with <code>slice()</code></a></li>
<li class="chapter" data-level="12.6.5" data-path="tidiest.html"><a href="tidiest.html#summary-functions"><i class="fa fa-check"></i><b>12.6.5</b> Summary functions</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="tidiest.html"><a href="tidiest.html#the-new-age-redux"><i class="fa fa-check"></i><b>12.7</b> The new age <em>redux</em></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="recap.html"><a href="recap.html"><i class="fa fa-check"></i><b>13</b> Recap</a><ul>
<li class="chapter" data-level="13.1" data-path="recap.html"><a href="recap.html#the-future"><i class="fa fa-check"></i><b>13.1</b> The future</a></li>
<li class="chapter" data-level="13.2" data-path="recap.html"><a href="recap.html#today"><i class="fa fa-check"></i><b>13.2</b> Today</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro R Workshop: Data Manipulation, Analysis and Graphing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapping" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> Mapping with <strong><code>ggplot2</code></strong></h1>
<blockquote>
<p>“There’s no map to human behaviour.”</p>
<p>— Bjork</p>
</blockquote>
<blockquote>
<p>“Here be dragons”</p>
<p>— Unknown</p>
</blockquote>
<p>Yesterday we learned how to create <strong><code>ggplot2</code></strong> figures, change their aesthetics, labels, colour palettes, and facet/grid them. Now we are going to look at how to create maps.</p>
<p>Most of the work that we perform as environmental/biological scientists involves going out to a location and sampling information there. Sometimes only once, and sometimes over a period of time. All of these different sampling methods lend themselves to different types of figures. One of those, collection of data at different points, is best shown with maps. As we will see over the course of the day, creating maps in <strong><code>ggplot2</code></strong> is very straight forward and enjoys extensive native support. For that reason we are going to have plenty of time to also learn how to do some more advanced things. Our goal is to produce something similar to the figure below.</p>
<div class="figure"><span id="fig:map-goal"></span>
<img src="figures/map_complete.png" alt="The goal for today." width="1050" />
<p class="caption">
Figure 8.1: The goal for today.
</p>
</div>
<p>Before we begin let’s go ahead and load the packages we will need, as well as the several dataframes required to make the final product.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load libraries</span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(ggpubr)

<span class="co"># Load data</span>
<span class="kw">load</span>(<span class="st">&quot;data/south_africa_coast.Rdata&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/sa_provinces.RData&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/site_list.Rdata&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/rast_annual.Rdata&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/rast_aug.Rdata&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/rast_feb.Rdata&quot;</span>)
<span class="kw">load</span>(<span class="st">&quot;data/MUR.Rdata&quot;</span>)

<span class="co"># The colour pallette we will use for ocean temperature</span>
cols11 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#004dcd&quot;</span>, <span class="st">&quot;#0068db&quot;</span>, <span class="st">&quot;#007ddb&quot;</span>, <span class="st">&quot;#008dcf&quot;</span>, <span class="st">&quot;#009bbc&quot;</span>,
            <span class="st">&quot;#00a7a9&quot;</span>, <span class="st">&quot;#1bb298&quot;</span>, <span class="st">&quot;#6cba8f&quot;</span>, <span class="st">&quot;#9ac290&quot;</span>, <span class="st">&quot;#bec99a&quot;</span>)</code></pre></div>
<div id="a-new-concept" class="section level2">
<h2><span class="header-section-number">8.1</span> A new concept?</h2>
<p>The idea of creating a map in R may be daunting to some, but remember that a basic map is nothing more than a simple figure with an x and y axis. We tend to think of maps as different from other scientific figures, whereas in reality they are created the exact same way. Let’s compare a dot plot of the chicken weight data against a dot plot of the coastline of South Africa.</p>
<p>Chicken dots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> ChickWeight, <span class="kw">aes</span>(<span class="dt">x =</span> Time, <span class="dt">y =</span> weight)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<div class="figure"><span id="fig:map-point-1"></span>
<img src="08-mapping_files/figure-html/map-point-1-1.png" alt="Dot plot of chicken weight data." width="672" />
<p class="caption">
Figure 8.2: Dot plot of chicken weight data.
</p>
</div>
<p>South African coast dots:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> south_africa_coast, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<div class="figure"><span id="fig:map-point-2"></span>
<img src="08-mapping_files/figure-html/map-point-2-1.png" alt="Dot plot off South African coast." width="672" />
<p class="caption">
Figure 8.3: Dot plot off South African coast.
</p>
</div>
<p>Does that look familiar? Notice how the x and y axis tick labels look the same as any map you would see in an atlas. This is because they are. But this isn’t a great way to create a map. Rather it is better to represent the land mass with a polygon. With <strong><code>ggplot2</code></strong> this is a simple task. In fact, there is already a global map built into the package.</p>
</div>
<div id="built-in-maps" class="section level2">
<h2><span class="header-section-number">8.2</span> Built in maps</h2>
<p>In the previous section we saw how to create a map of South Africa using a shape files we had saved on our computer. We are now going to learn how to use the shape files that are found within the <strong><code>tidyverse</code></strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">borders</span>() <span class="op">+</span><span class="st"> </span><span class="co"># The global shape file</span>
<span class="st">  </span><span class="kw">coord_equal</span>() <span class="co"># Equal sizing for lon/lat </span></code></pre></div>
<div class="figure"><span id="fig:map-world"></span>
<img src="08-mapping_files/figure-html/map-world-1.png" alt="The built in global shape file." width="672" />
<p class="caption">
Figure 8.4: The built in global shape file.
</p>
</div>
<p>Jikes! It’s as simple as that to load a map of the whole planet. Usually we are not going to want to make a map of the entire planet, so let’s see how to focus on just South Africa.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">borders</span>(<span class="dt">regions =</span> <span class="st">&quot;South Africa&quot;</span>, 
          <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># Set colour and fill</span>
<span class="st">  </span><span class="kw">coord_equal</span>()</code></pre></div>
<div class="figure"><span id="fig:map-SA-1"></span>
<img src="08-mapping_files/figure-html/map-SA-1-1.png" alt="Built in map of South Africa." width="672" />
<p class="caption">
Figure 8.5: Built in map of South Africa.
</p>
</div>
<p>Surprisingly, the international borders for South Africa do not account for Swaziland. That is an error. We also see in the above map that the exclusion of the southern African countries bordering on South Africa give it the appearance of an island. Marion Island is also giving us issues. This isn’t great, so let’s consider a different option for selecting the area around South Africa.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">south_africa &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">borders</span>(<span class="dt">fill =</span> <span class="st">&quot;grey70&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_equal</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">34</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">36</span>, <span class="op">-</span><span class="dv">26</span>), <span class="dt">expand =</span> <span class="dv">0</span>) <span class="co"># Define lon/lat extent</span>
south_africa</code></pre></div>
<div class="figure"><span id="fig:map-SA-2"></span>
<img src="08-mapping_files/figure-html/map-SA-2-1.png" alt="A better way to get the map of South Africa." width="672" />
<p class="caption">
Figure 8.6: A better way to get the map of South Africa.
</p>
</div>
<p>That is a very tidy looking map of South(ern) Africa without needing to load any files.</p>
</div>
<div id="creating-a-map" class="section level2">
<h2><span class="header-section-number">8.3</span> Creating a map</h2>
<p>Now that we have seen that a map is nothing more than a bunch of dots and shapes on specific points along the x and y axes we are going to look at the steps we would take to build a more complex map. Don’t worry if this seems daunting at first. We are going to take this step by step and ensure that each step is made clear along the way. Remember that in order to add something to a <strong><code>ggplot2</code></strong> figure we use a <code>+</code>. Because we already created our base map, <code>south_africa</code>, we will now simply add new lines of code to this base that we created.</p>
<p>The first thing we will add will be the province borders as seen in <a href="mapping.html#fig:map-goal">8.1</a>. Notice how we only add one more line of code to do this. The one hiccup here is that because the built in map has different names for the x and y axes than our data, we need to specifiy the <code>aes()</code> values for each new geom we add.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">south_africa <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> sa_provinces, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="co"># The province borders</span></code></pre></div>
<div class="figure"><span id="fig:map-province"></span>
<img src="08-mapping_files/figure-html/map-province-1.png" alt="The map of South Africa. Now with province borders!" width="672" />
<p class="caption">
Figure 8.7: The map of South Africa. Now with province borders!
</p>
</div>
<p>This is starting to look pretty fancy, but it would be nicer if there was some colour involved. So let’s add the ocean temperature. Again, this will only require one more line of code. Starting to see a pattern? But what is different this time and why?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">south_africa <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> MUR, <span class="kw">aes</span>(<span class="dt">fill =</span> bins, <span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span><span class="st"> </span><span class="co"># The ocean temperatures</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> sa_provinces, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group))</code></pre></div>
<div class="figure"><span id="fig:map-MUR"></span>
<img src="08-mapping_files/figure-html/map-MUR-1.png" alt="Ocean temperature (°C) visualised as an ice cream spill." width="672" />
<p class="caption">
Figure 8.8: Ocean temperature (°C) visualised as an ice cream spill.
</p>
</div>
<p>That looks… odd. Why do the colours look like someone melted a big bucket of ice cream in the ocean? This is because the colours you see in this figure are the default colours for discrete values in <strong><code>ggplot2</code></strong>. If we want to change them we may do so easily by adding yet one more line of code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">south_africa <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> MUR, <span class="kw">aes</span>(<span class="dt">fill =</span> bins, <span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> sa_provinces, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;Temp. (°C)&quot;</span>, <span class="dt">values =</span> cols11) <span class="co"># Set the colour palette</span></code></pre></div>
<div class="figure"><span id="fig:map-colour"></span>
<img src="08-mapping_files/figure-html/map-colour-1.png" alt="Ocean temperatures (°C) around South Africa." width="672" />
<p class="caption">
Figure 8.9: Ocean temperatures (°C) around South Africa.
</p>
</div>
<p>There’s a colour palette that would make Jacques Cousteau swoon. When we set the colour palette for a figure in <strong><code>ggplot2</code></strong> we must use that colour palette for all other instances of those types of values, too. What this means is that any other discrete values that will be filled in, like the ocean colour above, must use the same colour palette (there are some technical exceptions to this rule that we will not cover in this course). We normally want <strong><code>ggplot2</code></strong> to use consistent colour palettes anyway, but it is important to note that this constraint exists. Let’s see what we mean. Next we will add the coastal pixels to our figure with one more line of code. We won’t change anything else. Note how <strong><code>ggplot2</code></strong> changes the colour of the coastal pixels to match the ocean colour automatically. Let’s also add some points to highlight major cities while we are at it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">south_africa <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> MUR, <span class="kw">aes</span>(<span class="dt">fill =</span> bins, <span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> sa_provinces, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> rast_annual, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">fill =</span> bins), 
            <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span><span class="co"># The coastal temperature values</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> site_list, <span class="dt">alpha =</span> <span class="fl">0.4</span>,
             <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span><span class="st"> </span><span class="co"># Coastal city locations</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;Temp. (°C)&quot;</span>, <span class="dt">values =</span> cols11)</code></pre></div>
<div class="figure"><span id="fig:map-raster"></span>
<img src="08-mapping_files/figure-html/map-raster-1.png" alt="Map of SOuth Africa showing *in situ* temeperatures (°C) as pixels along the coast." width="672" />
<p class="caption">
Figure 8.10: Map of SOuth Africa showing <em>in situ</em> temeperatures (°C) as pixels along the coast.
</p>
</div>
<p>We used <code>geom_tile()</code> instead of <code>geom_rast()</code> to add the coastal pixels above so that we could add those little white boxes around them. This figure is looking pretty great now. And it only took a few rows of code to put it all together! The last step is to add several more lines of code that will control for all of the little things we want to change about the appearance of the figure. Each little thing that is changed below is annotated for your convenience.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fig_top &lt;-<span class="st"> </span>south_africa <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_raster</span>(<span class="dt">data =</span> MUR, <span class="kw">aes</span>(<span class="dt">fill =</span> bins, <span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_path</span>(<span class="dt">data =</span> sa_provinces, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">group =</span> group)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_tile</span>(<span class="dt">data =</span> rast_annual, <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat, <span class="dt">fill =</span> bins), 
            <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="fl">0.1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> site_list, <span class="dt">alpha =</span> <span class="fl">0.4</span>,
             <span class="kw">aes</span>(<span class="dt">x =</span> lon, <span class="dt">y =</span> lat)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="st">&quot;Temp. (°C)&quot;</span>, <span class="dt">values =</span> cols11) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">position =</span> <span class="st">&quot;top&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># Put x axis labels on top of figure</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.title =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove the axis labels</span>
        <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>), <span class="co"># Change text size in legend</span>
        <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>), <span class="co"># Change legend title text size</span>
        <span class="dt">legend.key.height =</span> <span class="kw">unit</span>(<span class="fl">0.3</span>, <span class="st">&quot;cm&quot;</span>), <span class="co"># Change size of legend</span>
        <span class="dt">legend.background =</span> <span class="kw">element_rect</span>(<span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>), <span class="co"># Add legend background</span>
        <span class="dt">legend.justification =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="co"># Change position of legend</span>
        <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="fl">0.55</span>, <span class="fl">0.4</span>) <span class="co"># Fine tune position of legend</span>
        )
fig_top</code></pre></div>
<div class="figure"><span id="fig:map-final"></span>
<img src="08-mapping_files/figure-html/map-final-1.png" alt="The cleaned up map of South Africa. Resplendent with coastal and ocean temperatures (°C)." width="672" />
<p class="caption">
Figure 8.11: The cleaned up map of South Africa. Resplendent with coastal and ocean temperatures (°C).
</p>
</div>
<p>That is a very clean looking map and is going to serve as the top half of the figure we are putting together today. For the bottom half we are now going to look at how to create a ribbon in <strong><code>ggplot2</code></strong>.</p>
</div>
<div id="a-ribbon-for-your-troubles" class="section level2">
<h2><span class="header-section-number">8.4</span> A ribbon for your troubles</h2>
<p>For the bottom portion of our figure we want to add a ribbon that shows the mean temperature along the coast, as well as the coldest (August) and warmest (February) months of the year. This allows us to visualise what the range of temperatures along the coast are.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> rast_annual, <span class="kw">aes</span>(<span class="dt">x =</span> index, <span class="dt">y =</span> temp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> rast_aug<span class="op">$</span>temp, <span class="dt">ymax =</span> rast_feb<span class="op">$</span>temp), <span class="dt">fill =</span> <span class="st">&quot;grey80&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> temp), <span class="dt">size =</span> <span class="fl">0.6</span>)</code></pre></div>
<div class="figure"><span id="fig:ribbon-base"></span>
<img src="08-mapping_files/figure-html/ribbon-base-1.png" alt="An 'out-of-the-box' ribbon geom of seasonal *in situ* temperatures (°C) along the coast of South Africa." width="672" />
<p class="caption">
Figure 8.12: An ‘out-of-the-box’ ribbon geom of seasonal <em>in situ</em> temperatures (°C) along the coast of South Africa.
</p>
</div>
<p>That looks pretty good already. But let’s change the colour of the points so that they match the map we are using.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> rast_annual, <span class="kw">aes</span>(<span class="dt">x =</span> index, <span class="dt">y =</span> temp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> rast_feb<span class="op">$</span>temp, <span class="dt">ymax =</span> rast_aug<span class="op">$</span>temp), <span class="dt">fill =</span> <span class="st">&quot;grey80&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> temp), <span class="dt">size =</span> <span class="fl">0.6</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="st">&quot;Temp. (°C)&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">30</span>), <span class="dt">colours =</span> cols11, 
                         <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">12</span>, <span class="dv">28</span>, <span class="dv">4</span>))</code></pre></div>
<div class="figure"><span id="fig:ribbon-colour"></span>
<img src="08-mapping_files/figure-html/ribbon-colour-1.png" alt="The same ribbon but with the correct colour scale." width="672" />
<p class="caption">
Figure 8.13: The same ribbon but with the correct colour scale.
</p>
</div>
<p>Notice that whereas the colours look the same, for this ribbon we are using temperature (°C) as a continuous variable and not a discrete variable. This is why we have to provide the ‘break’ information in the line that changes the colours for our ribbon. The next thing we want to do is change the labels for the x and y axes and remove the legend. Because we are going to have a legend in the top half of the figure, we don’t need one for the bottom half.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> rast_annual, <span class="kw">aes</span>(<span class="dt">x =</span> index, <span class="dt">y =</span> temp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> rast_feb<span class="op">$</span>temp, <span class="dt">ymax =</span> rast_aug<span class="op">$</span>temp), <span class="dt">fill =</span> <span class="st">&quot;gray80&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> temp), <span class="dt">size =</span> <span class="fl">0.6</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="st">&quot;Temp. (°C)&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">30</span>), <span class="dt">colours =</span> cols11, 
                         <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">12</span>, <span class="dv">28</span>, <span class="dv">4</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="co"># Remove the legend</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Temperature (°C)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="co"># Change the x and y axis label</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">14</span>, <span class="dv">26</span>, <span class="dv">3</span>), 
                     <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span><span class="co"># Change the y axis ticks</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> site_list<span class="op">$</span>index2, 
                     <span class="dt">labels =</span> site_list<span class="op">$</span>site, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="co"># Change x axis ticks</span></code></pre></div>
<div class="figure"><span id="fig:ribbon-axes"></span>
<img src="08-mapping_files/figure-html/ribbon-axes-1.png" alt="A ribbon with some apparent issues." width="672" />
<p class="caption">
Figure 8.14: A ribbon with some apparent issues.
</p>
</div>
<p>It may look like we have taken a step backward, but we are about to sort everything out in a very nice way. To do this we will need to manipulate the minutia of the figure using <code>theme()</code>. Again, we will label each line to add clarity to the process.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fig_bottom &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> rast_annual, <span class="kw">aes</span>(<span class="dt">x =</span> index, <span class="dt">y =</span> temp)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> rast_feb<span class="op">$</span>temp, <span class="dt">ymax =</span> rast_aug<span class="op">$</span>temp), <span class="dt">fill =</span> <span class="st">&quot;gray80&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> temp), <span class="dt">size =</span> <span class="fl">0.6</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_colour_gradientn</span>(<span class="st">&quot;Temp. (°C)&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">30</span>), <span class="dt">colours =</span> cols11, 
                         <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">12</span>, <span class="dv">28</span>, <span class="dv">4</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Temperature (°C)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">14</span>, <span class="dv">26</span>, <span class="dv">3</span>), 
                     <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> site_list<span class="op">$</span>index2, 
                     <span class="dt">labels =</span> site_list<span class="op">$</span>site, <span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.background =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove the panel background</span>
        <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove the panel border</span>
        <span class="dt">plot.background =</span> <span class="kw">element_blank</span>(), <span class="co"># Remove the background</span>
        <span class="dt">panel.grid.major.x =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, 
                                          <span class="dt">linetype =</span> <span class="st">&quot;dotted&quot;</span>, 
                                          <span class="dt">size =</span> <span class="fl">0.2</span>), <span class="co"># Change the x axis gridlines</span>
        <span class="dt">panel.grid.major.y =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="ot">NA</span>), <span class="co"># Remove the y axis gridlines</span>
        <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, 
                                   <span class="dt">hjust =</span> <span class="dv">1</span>, 
                                   <span class="dt">vjust =</span> <span class="fl">0.5</span>, 
                                   <span class="dt">size =</span> <span class="dv">7</span>), <span class="co"># Change the x axis labels</span>
        <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">7</span>), <span class="co"># Change the y axis labels</span>
        <span class="dt">axis.title.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">8</span>) <span class="co"># Change y axis title size </span>
        )
fig_bottom</code></pre></div>
<div class="figure"><span id="fig:ribbon-final"></span>
<img src="08-mapping_files/figure-html/ribbon-final-1.png" alt="The finished ribbon." width="672" />
<p class="caption">
Figure 8.15: The finished ribbon.
</p>
</div>
<p>And there we have it. This is a very nice ribbon figure showing the annual range of temperatures along the coast of South Africa. But it relies on the map figure to be complete.</p>
</div>
<div id="combining-figures" class="section level2">
<h2><span class="header-section-number">8.5</span> Combining figures</h2>
<p>We learned yesterday how to combine figures with <strong><code>ggpubr</code></strong> so that all of the figures in the grid were an equal size. In this instance however we want the map panel of our figure to be twice as high as the ribbon panel. In order to do so we will use the <code>heights</code> argument to change the relative height of each row in our grid.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create an object that contains all of the map data</span>
final &lt;-<span class="st"> </span><span class="kw">ggarrange</span>(fig_top, fig_bottom, 
                   <span class="dt">nrow =</span> <span class="dv">2</span>,
                   <span class="dt">heights =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)) <span class="co"># Adjust heights of the rows</span>
final</code></pre></div>
<div class="figure"><span id="fig:map-grid"></span>
<img src="08-mapping_files/figure-html/map-grid-1.png" alt="The finished product." width="672" />
<p class="caption">
Figure 8.16: The finished product.
</p>
</div>
<!-- Why is the top panel slightly narrower than the bottom panel? This is because we used `coord_equal()` to constrain the lon/lat extent in our map. Whereas this may produce maps that are aesthetically pleasing, it can have unintended consequences.  -->
<p>Finally, let’s save the fruits of our labours.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggsave</span>(<span class="dt">plot =</span> final, <span class="st">&quot;figures/map_complete.pdf&quot;</span>)</code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="plot-stats.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mapping-google.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
